<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.smallnine.apiserver.dao.CouponDao">

    <resultMap id="CouponResultMap" type="com.smallnine.apiserver.entity.Coupon">
        <id property="id" column="id" />
        <result property="code" column="code" />
        <result property="name" column="name" />
        <result property="description" column="description" />
        <result property="discountType" column="discount_type" />
        <result property="discountValue" column="discount_value" />
        <result property="minimumAmount" column="minimum_amount" />
        <result property="maximumUses" column="maximum_uses" />
        <result property="usedCount" column="used_count" />
        <result property="startsAt" column="starts_at" />
        <result property="expiresAt" column="expires_at" />
        <result property="isActive" column="is_active" />
        <result property="createdAt" column="created_at" />
    </resultMap>

    <select id="findAllActive" resultMap="CouponResultMap">
        SELECT * FROM coupons
        WHERE is_active = TRUE
          AND (expires_at IS NULL OR expires_at > NOW())
        ORDER BY created_at DESC
    </select>

    <select id="findById" resultMap="CouponResultMap">
        SELECT * FROM coupons WHERE id = #{id}
    </select>

</mapper>
